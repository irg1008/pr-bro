---
import BaseLayout from "@/layouts/BaseLayout.astro";
import type {
	Routine,
	RoutineGroup,
	WorkoutLog,
} from "prisma/generated/client";
import { GET } from "./api/workout-logs";

const response = await GET(Astro);
type WorkoutLogWithRoutine = WorkoutLog & {
	routine: Routine & { group: RoutineGroup };
};
const logs: WorkoutLogWithRoutine[] = await response.json();
---

<BaseLayout title="Workout History">
	<div class="container mx-auto py-8 px-4">
		<h1 class="text-3xl font-bold mb-8">Workout History</h1>

		<div class="space-y-4">
			{
				logs.map((log) => (
					<a
						href={`/history/${log.id}`}
						class="block rounded-lg border bg-card text-card-foreground shadow-sm p-4 hover:bg-accent transition-colors"
					>
						<div class="flex justify-between items-center">
							<div>
								<h3 class="font-bold text-lg">{log.routine.name}</h3>
								<p class="text-sm text-muted-foreground">
									{log.routine.group.name} &bull;{" "}
									{new Date(log.createdAt).toLocaleDateString()}
								</p>
							</div>
							<div class="text-right">
								<div class="text-sm font-medium">
									{log.duration
										? Math.round(log.duration / 60) + " min"
										: "N/A"}
								</div>
							</div>
						</div>
					</a>
				))
			}
			{
				logs.length === 0 && (
					<div class="text-center py-12 text-muted-foreground">
						No history found.
					</div>
				)
			}
		</div>
	</div>
</BaseLayout>
